<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Fabian Krüger">
<title>Developer Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Developer Documentation</h1>
<div class="details">
<span id="author" class="author">Fabian Krüger</span><br>
<span id="revdate">2022-02-28</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_getting_started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#_requirements">2.1. Requirements</a></li>
<li><a href="#_build_and_run">2.2. Build and Run</a></li>
</ul>
</li>
<li><a href="#_concepts">3. Concepts</a>
<ul class="sectlevel2">
<li><a href="#_recipes">3.1. Recipes</a></li>
<li><a href="#_actions">3.2. Actions</a></li>
<li><a href="#_projectcontext">3.3. ProjectContext</a></li>
<li><a href="#Finders">3.4. Finders</a></li>
<li><a href="#_multi_module_projects">3.5. Multi module projects</a></li>
<li><a href="#_application_lifecycle">3.6. Application Lifecycle</a>
<ul class="sectlevel3">
<li><a href="#_scan_application">3.6.1. Scan Application</a></li>
<li><a href="#_apply_recipe">3.6.2. Apply Recipe</a></li>
</ul>
</li>
<li><a href="#_modules">3.7. Modules</a></li>
<li><a href="#_spring_boot_resources">3.8. Spring Boot Resources</a>
<ul class="sectlevel3">
<li><a href="#_spring_restcontroller_bean">3.8.1. Spring RestController Bean</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_how_to">4. How To</a>
<ul class="sectlevel2">
<li><a href="#_check_preconditions">4.1. Check Preconditions</a></li>
<li><a href="#_implement_actions">4.2. Implement Actions</a>
<ul class="sectlevel3">
<li><a href="#_display_progress">4.2.1. Display Progress</a></li>
</ul>
</li>
<li><a href="#_creating_recipes">4.3. Creating Recipes</a>
<ul class="sectlevel3">
<li><a href="#_declarative_recipes">4.3.1. Declarative recipes</a></li>
<li><a href="#_recipe_beans">4.3.2. Recipe beans</a></li>
</ul>
</li>
<li><a href="#_using_openrewrite_recipes">4.4. Using OpenRewrite Recipes</a>
<ul class="sectlevel3">
<li><a href="#_programmatically">4.4.1. Programmatically</a></li>
<li><a href="#_in_sbm_yaml">4.4.2. In SBM YAML</a></li>
<li><a href="#_in_sbm_java_code">4.4.3. In SBM Java code</a></li>
</ul>
</li>
<li><a href="#_create_a_condition">4.5. Create a Condition</a></li>
<li><a href="#_single_and_multi_module_projects">4.6. Single and Multi module projects</a>
<ul class="sectlevel3">
<li><a href="#_application_modules">4.6.1. Application Modules</a></li>
</ul>
</li>
<li><a href="#_buildfile_and_dependencies">4.7. BuildFile and Dependencies</a>
<ul class="sectlevel3">
<li><a href="#_adding_a_dependency">4.7.1. Adding a Dependency</a></li>
<li><a href="#_removing_a_dependency">4.7.2. Removing a Dependency</a></li>
<li><a href="#_adding_dependency_exclusion">4.7.3. Adding Dependency Exclusion</a></li>
</ul>
</li>
<li><a href="#_migrating_java_code">4.8. Migrating Java Code</a>
<ul class="sectlevel3">
<li><a href="#_access_all_javasources">4.8.1. Access all JavaSources</a></li>
<li><a href="#_adding_annotations">4.8.2. Adding annotations</a></li>
<li><a href="#_removing_annotations">4.8.3. Removing annotations</a></li>
<li><a href="#_modifying_annotations">4.8.4. Modifying annotations</a></li>
<li><a href="#_migrating_methods">4.8.5. Migrating Methods</a></li>
<li><a href="#_add_a_new_javasource">4.8.6. Add a new JavaSource</a></li>
</ul>
</li>
<li><a href="#_openrewrite_recipe_and_visitor">4.9. OpenRewrite Recipe and Visitor</a></li>
<li><a href="#_use_freemarker_templates">4.10. Use Freemarker templates</a></li>
<li><a href="#_migrate_multi_module_projects">4.11. Migrate Multi Module Projects</a>
<ul class="sectlevel3">
<li><a href="#_access_a_modules_javasources">4.11.1. Access a Module&#8217;s JavaSources</a></li>
</ul>
</li>
<li><a href="#Specialized_Resources">4.12. Specialized Resources</a>
<ul class="sectlevel3">
<li><a href="#_create_a_finder_to_access_other_resources">4.12.1. Create a Finder to access other resources</a></li>
<li><a href="#_manipulate_spring_boot_properties">4.12.2. Manipulate Spring Boot properties</a></li>
<li><a href="#_create_a_specialized_resource">4.12.3. Create a specialized Resource</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_testing">5. Testing</a>
<ul class="sectlevel2">
<li><a href="#_windows_linux">5.1. Windows &amp; Linux</a>
<ul class="sectlevel3">
<li><a href="#_ignoring_line_separator_in_assertions">5.1.1. Ignoring Line separator in assertions</a></li>
</ul>
</li>
<li><a href="#_testprojectcontext">5.2. TestProjectContext</a></li>
<li><a href="#_projectcontextfilesystemtestsupport">5.3. ProjectContextFileSystemTestSupport</a></li>
<li><a href="#_recipeintegrationtestsupport">5.4. RecipeIntegrationTestSupport</a></li>
<li><a href="#_integrationtestbaseclass">5.5. IntegrationTestBaseClass</a></li>
</ul>
</li>
<li><a href="#_contributing">6. Contributing</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot Migrator (SBM) aims to help developers migrating applications to Spring Boot, upgrade existing Boot applications or migrate an application to use Spring Boot features.<br>
These migrations are defined as recipes consisting of one or more actions to be applied to the target application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">2. Getting started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_requirements">2.1. Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>Maven</p>
</li>
<li>
<p>JDK 11+</p>
</li>
<li>
<p>IntelliJ (other IDEs should work too)</p>
</li>
<li>
<p>Docker (for tests)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_build_and_run">2.2. Build and Run</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong><code>M2_HOME</code> env must be set</strong> to run integration tests!<br>
<strong>Docker must be installed</strong> to run (some) integration tests!
To build SBM ignoring integration tests you can run <code>mvn clean install -DskipITs</code>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># clone project
git clone0 git@github.com:spring-projects-experimental/spring-boot-migrator.git

# build project
cd spring-boot-migrator
mvn clean install

# Ignore all tests
mvn clean install -DskipTests

# Ignore all tests marked with @Tag("integration")
mvn clean install -DskipITs

# Run the jar
java -jar applications/spring-shell/target/spring-boot-migrator.jar</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">3. Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SBM offers commands to scan application source code and run recipes against it.
Recipes bundle actions to apply source code migrations or find information in the codebase.</p>
</div>
<div class="paragraph">
<p>An <code>Action</code> is a single step in a recipe and can be reused by other recipes.
Every <code>Recipe</code> has at least one <code>Action</code> and each Recipe and every action has a condition which defines if the recipe and/or it&#8217;s actions are applicable.</p>
</div>
<div class="paragraph">
<p>The condition has access to all resources to evaluate to <code>true</code> or <code>false</code>.
If a recipe&#8217;s condition evaluates to <code>false</code> the recipe is not displayed.
Actions with a condition evaluating to <code>true</code> are applicable and will be executed with the recipe.
When all actions of a recipe evaluate to <code>false</code> the recipe itself is not applicable.</p>
</div>
<div class="sect2">
<h3 id="_recipes">3.1. Recipes</h3>
<div class="paragraph">
<p>Recipes can be declared in yaml syntax or provided as Java bean definitions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See <a href="https://github.com/spring-projects-experimental/spring-boot-migrator/blob/main/components/sbm-support-boot/src/main/resources/recipes/initialize-spring-boot-migration.yaml" target="_blank" rel="noopener">initialize-spring-boot-migration.yaml</a> for a recipe in YAML syntax</p>
</li>
<li>
<p>See <a href="https://github.com/spring-projects-experimental/spring-boot-migrator/blob/main/components/sbm-recipes-mule-to-boot/src/main/java/org/springframework/sbm/mule/MigrateMuleToBoot.java" target="_blank" rel="noopener">MigrateMuleToBoot.java</a> for a recipe as Spring bean.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_actions">3.2. Actions</h3>
<div class="paragraph">
<p>Action is the starting point when developing a recipe.
Every Action has access to all resources and their ASTs through the <code>ProjectContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class MyAction extends AbstractAction {
    void apply(ProjectContext context) {
        // analyse and modify AST
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_projectcontext">3.3. ProjectContext</h3>
<div class="paragraph">
<p>After scanning and parsing the source code of a given application a <code>ProjectContext</code> gets created.
The <code>ProjectContext</code> acts as facade to the <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">abstract syntax tree</a> (AST) of the project and provides an API to access project resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ProjectJavaSources pjs = context.getProjectJavaSources();
ApplicationModules am = context.getApplicationModules()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ProjectContext</code> represents the current application state in memory and provides access to all resources.
The API provides methods to retrieve and modify Java source, application modules and build files.
All other resource types can be retrieved using finders.</p>
</div>
</div>
<div class="sect2">
<h3 id="Finders">3.4. Finders</h3>
<div class="paragraph">
<p>Finders are useful to access and filter resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ProjectResourceFinder&lt;T&gt; {
    T apply(ProjectResourceSet projectResourceSet);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finder have access to the <code>ProjectResourceSet</code> (see <a href="#ProjectResourceSet">[ProjectResourceSet]</a>) to filter/find resources and return the result.
The result is of the same type as the generic type <code>T</code>.</p>
</div>
<div class="paragraph">
<p>The ProjectContext provides a <code>search(..)</code> method to apply Finder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;..&gt; resources = projectContext.search(new PathMatchingProjectResourceFinder("/**/some/path/*.file"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finders also provide access to specialized resources, resources that are not directly accessible through the ProjectContext Api.
Specialized resources like <code>SpringBootApplicationProperties</code>, <code>PersistenceXml</code>, <code>WebXml</code>, &#8230;&#8203;, can be retrieved by their <code>Finder</code>s.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">void apply(ProjectContext context) {
    SpringBootApplicationProperties p = context.search(new SpringBootApplicationPropertiesFinder());
    p.getProperty("cloud-profile", "some.property.key")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read the <a href="#Specialized_Resources">Specialized Resources</a> section to learn how you can provide new Specialized Resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_module_projects">3.5. Multi module projects</h3>

</div>
<div class="sect2">
<h3 id="_application_lifecycle">3.6. Application Lifecycle</h3>
<div class="sect3">
<h4 id="_scan_application">3.6.1. Scan Application</h4>
<div class="paragraph">
<p>The user provides a root directory to scan a project.
After scanning the given directory a set of preconditions is checked to verify that the scanned project can be successfully parsed.
See <a href="#_check_preconditions">Check Preconditions</a> to learn how you can provide additional precondition checks.</p>
</div>
<div class="sect4">
<h5 id="_parsing">Parsing</h5>
<div class="paragraph">
<p>When all preconditions are met the project resources are parsed and the abstract syntax tree (AST) gets created in memory.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specialized_resources">Specialized Resources</h5>
<div class="paragraph">
<p>After parsing the project resources a set of <code>ProjectResourceWrapper</code>s is called and generic resources can be replaced
with more specialized resources providing a specialized API for these resources.
Think of replacing a generic XML file representing <code>persistence.xml</code> (JPA deployment descriptor) with a specialized
resource representation offering an API to act on a specialized "JPA deployment descriptor".
See <a href="#_specialized_resources">Specialized Resources</a> to learn how yo can provide specialized resources.</p>
</div>
</div>
<div class="sect4">
<h5 id="_creating_the_projectcontext">Creating the ProjectContext</h5>
<div class="paragraph">
<p>After replacing specialized resources the ProjectContext gets created.</p>
</div>
</div>
<div class="sect4">
<h5 id="_display_applicable_recipes">Display Applicable Recipes</h5>
<div class="paragraph">
<p>With the <code>ProjectContext</code> in place SBM checks all <code>Condition</code>s of recipes and their <code>Action</code>s to find applicable recipes.
The resulting list of applicable recipes is then shown to the user to select and apply recipes against the scanned application.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_apply_recipe">3.6.2. Apply Recipe</h4>
<div class="paragraph">
<p>The user applies a recipe from the list of applicable recipes.</p>
</div>
<div class="sect4">
<h5 id="_applying_recipe_actions">Applying Recipe Actions</h5>
<div class="paragraph">
<p>SBM provides the <code>ProjectContext</code> to the list of applicable <code>Action</code>s and each <code>Action</code> modifies the AST through the
<code>ProjectContext</code> API. These modifications are only represented in memory.</p>
</div>
</div>
<div class="sect4">
<h5 id="_verify_application_in_sync">Verify Application In Sync</h5>
<div class="paragraph">
<p>After applying all <code>Action</code>s of the <code>Recipe</code> the changes need to be written back to filesystem.
When <code>sbm.gitSupportEnabled</code> is <code>true</code> SBM verifies that nothing changed in the scanned project while the recipe was applied.
If the git hash changed or non-indexed resources are found the changes are rolled back, the project must be synced,
re-scanned and the recipe needs to be re-applied.</p>
</div>
</div>
<div class="sect4">
<h5 id="_writing_back_changes">Writing Back Changes</h5>
<div class="paragraph">
<p>When git support is disabled or the project is in sync the in-memory representation is written back to the file system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_commit_changes">Commit Changes</h5>
<div class="paragraph">
<p>When git support is enabled SBM commits the changes applied by running the recipe and the next recipe can be applied.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modules">3.7. Modules</h3>
<div class="paragraph">
<p>Since 0.9.0 SBM starts to support <a href="https://maven.apache.org/guides/mini/guide-multiple-modules.html#the-reactor">multi module applications</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_spring_boot_resources">3.8. Spring Boot Resources</h3>
<div class="sect3">
<h4 id="_spring_restcontroller_bean">3.8.1. Spring RestController Bean</h4>
<div class="paragraph">
<p>Classes annotated with Spring <code>@RestController</code> annotation can be found using the <code>FindRestControllerBeans</code> finder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;RestControllerBean&gt; restController = projectContext.search(new FindRestControllerBeans());

List&lt;RestMethod&gt; restMethods = restController.get(0).getRestMethods();

restMethods.get(0).</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to">4. How To</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_check_preconditions">4.1. Check Preconditions</h3>
<div class="paragraph">
<p>Preconditions that must be met to allow a successful migration can be checked before scanning an application.
This allows a user to be informed about unmet preconditions that would prevent a successful migration before the
sometimes lengthy parsing is done.</p>
</div>
<div class="paragraph">
<p>To add a new precondition check you need to provide a component extending abstract <code>PreconditionCheck</code> class
and return the result of the precondition check as <code>PreconditionCheckResult</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class MyPreconditionCheck extends PreconditionCheck {
    @Override
    public PreconditionCheckResult verify(Path projectRoot, List&lt;Resource&gt; projectResources) {
        // verify precondition is met...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class must be placed under <code>org.springframework.sbm</code> to be picked up by component scan and gets executed after scanning
the project but before parsing resources into an AST.
If one of the preconditions fails (<code>ResultState.WARN</code> or <code>ResultState.FAILED</code>), the scan is interrupted and a message is
shown to the user.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implement_actions">4.2. Implement Actions</h3>
<div class="paragraph">
<p>First step on your journey to implement a new recipe will be the implementation of an <code>Action</code>.
Every Action that needs access to the ProjectContext to modify resources should extend <code>AbstractAction</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class MyAction extends AbstractAction {
    void apply(ProjectContext context) {
        // analyse and modify AST
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <a href="#_testprojectcontext">TestProjectContext</a> to test your Action.</p>
</div>
<div class="sect3">
<h4 id="_display_progress">4.2.1. Display Progress</h4>
<div class="paragraph">
<p>A long running action can leave the user without any information about the progress of the migration.</p>
</div>
<div class="paragraph">
<p>The <code>Action</code> interface defines methods to display progress information to the user.
There are two types of rendered information, process and log messages.</p>
</div>
<div class="sect4">
<h5 id="_process">Process</h5>
<div class="paragraph">
<p><code>startStep(String)</code> starts a new sub routine.</p>
</div>
<div class="paragraph">
<p><code>stopStep()</code> stops the last sub routine</p>
</div>
</div>
<div class="sect4">
<h5 id="_log_messages">Log Messages</h5>
<div class="paragraph">
<p><code>logEvent(String)</code> logs a message inside a routine</p>
</div>
<div class="paragraph">
<p>When an action starts, a first process (the action) is automatically started.
It begins with the action and ends with success or error.
If no other progress change is reported during the execution of the action, a loader is rendered during the</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">.    My Action
..   My Action
[..] My Action
    .    Sub Routine
    ..   Sub Routine
    [ok] Sub Routine
[ok] My Action</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_recipes">4.3. Creating Recipes</h3>
<div class="paragraph">
<p>Recipes bundle a set of Actions for a migration.
They can be declared programmatically as Spring beans or declarative using yaml syntax.
The main difference is that yaml recipes can be provided to SBM without code changes on startup allowing to add new,
declarative recipes without recompilation while the bean definition is arguably easier to use.</p>
</div>
<div class="sect3">
<h4 id="_declarative_recipes">4.3.1. Declarative recipes</h4>
<div class="paragraph">
<p>Declarative recipes must be placed under <code>src/main`resources/recipes</code>.<br>
See <a href="https://github.com/spring-projects-experimental/spring-boot-migrator/blob/main/components/sbm-support-boot/src/main/resources/recipes/initialize-spring-boot-migration.yaml" target="_blank" rel="noopener">initialize-spring-boot-migration.yaml</a> for a recipe in YAML syntax</p>
</div>
</div>
<div class="sect3">
<h4 id="_recipe_beans">4.3.2. Recipe beans</h4>
<div class="paragraph">
<p>A recipe can be defined as Spring bean using @Bean annotated method, see <a href="https://github.com/spring-projects-experimental/spring-boot-migrator/blob/main/components/sbm-recipes-mule-to-boot/src/main/java/org/springframework/sbm/mule/MigrateMuleToBoot.java" target="_blank" rel="noopener">MigrateMuleToBoot.java</a> for a recipe declared as Spring bean.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Remember to provide a description to all Actions to display the description to the user when the Action is applied.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_openrewrite_recipes">4.4. Using OpenRewrite Recipes</h3>
<div class="sect3">
<h4 id="_programmatically">4.4.1. Programmatically</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ProjectContext context = ...
String annotationPattern = "@java.lang.Deprecated";
org.openrewrite.java.RemoveAnnotation rewriteRecipe = new RemoveAnnotation(annotationPattern);
context.getProjectJavaSources().apply(rewriteRecipe);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_in_sbm_yaml">4.4.2. In SBM YAML</h4>
<div class="sect4">
<h5 id="_using_declarative_openrewrite_yaml">Using Declarative OpenRewrite YAML</h5>
<div class="paragraph">
<p>Use <code>org.springframework.sbm.engine.recipe.OpenRewriteDeclarativeRecipeAdapter</code> to use embedded OpenRewrite YAML syntax in SBM YAML to run a declarative OpenRewrite recipe as SBM action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- name: test-recipe
  description: "Remove @Deprecated annotations"
  condition:
    type: org.springframework.sbm.common.migration.conditions.TrueCondition
  actions:
    - type: org.springframework.sbm.engine.recipe.OpenRewriteDeclarativeRecipeAdapter
      description: "Use a OpenRewrite recipe to remove @Deprecated annotations"
      openRewriteRecipe: |-
        type: specs.openrewrite.org/v1beta/recipe
        name: org.openrewrite.java.RemoveAnnotation
        displayName: "Remove @Deprecated annotation"
        description: "Remove @Deprecated annotation"
        recipeList:
          - org.openrewrite.java.RemoveAnnotation:
              annotationPattern: "@java.lang.Deprecated"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_by_name">By Name</h5>
<div class="paragraph">
<p>Use <code>org.springframework.sbm.engine.recipe.OpenRewriteNamedRecipeAdapter</code> to run an OpenRewrite recipe by name as SBM action.
Here an OpenRewrite recipe with name <code>org.springframework.sbm.dummy.RemoveDeprecatedAnnotation</code> must exist on the classpath and will be executed as action in <code>test-recipe</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- name: test-recipe
  description: "Remove @Deprecated annotations"
  condition:
    type: org.springframework.sbm.common.migration.conditions.TrueCondition
  actions:
    - type: org.springframework.sbm.engine.recipe.OpenRewriteNamedRecipeAdapter
      description: "Call a OpenRewrite recipe to remove @Deprecated annotations"
      openRewriteRecipeName: org.springframework.sbm.dummy.RemoveDeprecatedAnnotation</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_in_sbm_java_code">4.4.3. In SBM Java code</h4>
<div class="sect4">
<h5 id="_using_declarative_openrewrite_yaml_2">Using Declarative OpenRewrite YAML</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class SomeRecipe {

    @Bean
    Recipe someRecipe(RewriteRecipeLoader rewriteRecipeLoader, RewriteMigrationResultMerger resultMerger) {
        return Recipe.builder()
                ...
                .action(
                        OpenRewriteDeclarativeRecipeAdapter.builder()
                                .rewriteRecipeLoader(rewriteRecipeLoader)
                                .resultMerger(resultMerger)
                                .openRewriteRecipe(
                                    "type: specs.openrewrite.org/v1beta/recipe\n" +
                                    "name: org.openrewrite.java.RemoveAnnotation\n" +
                                    "displayName: \"Remove @Deprecated annotation\"\n" +
                                    "description: \"Remove @Deprecated annotation\"\n" +
                                    "recipeList:\n" +
                                    "  - org.openrewrite.java.RemoveAnnotation:\n" +
                                    "      annotationPattern: \"@java.lang.Deprecated\"\n"
                                )
                                .build())
                ...
                .build();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_by_name_2">By Name</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class SomeRecipe {

    @Bean
    Recipe someRecipe(RewriteRecipeLoader rewriteRecipeLoader, RewriteMigrationResultMerger resultMerger) {
        return Recipe.builder()
                ...
                .action(
                        OpenRewriteNamedRecipeAdapter.builder()
                                .rewriteRecipeLoader(rewriteRecipeLoader)
                                .resultMerger(resultMerger)
                                .openRewriteRecipeName(
                                    "org.springframework.sbm.dummy.RemoveDeprecatedAnnotation"
                                )
                                .build())
                ...
                .build();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_condition">4.5. Create a Condition</h3>
<div class="paragraph">
<p>Every <code>Action</code> and every <code>Recipe</code> must have a <code>Condition</code> which defines if the <code>Recipe</code> or <code>Action</code> is applicable.
Therefore the <code>Condition</code> interface must be implemented which defines a <code>evaluate(ProjectContext)</code> method which must return true if the Recipe or Action is applicable and false otherwise.
A condition should only read from the <code>ProjectContext</code> and never modify the AST.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyCondition implements Condition {
    @Override
    public boolean evaluate(ProjectContext context) {
        // analyze ProjectContext to evaluate condition
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_single_and_multi_module_projects">4.6. Single and Multi module projects</h3>
<div class="paragraph">
<p>Projects can come as single module or multi-module project.
Working with single module projects is significantly easier because only one <code>BuildFile</code> exists.
With multi-module projects the application modules play a central role and there must be means to
select a module.</p>
</div>
<div class="sect3">
<h4 id="_application_modules">4.6.1. Application Modules</h4>
<div class="paragraph">
<p>A common multi-module project has a root modules which consists of one or more child modules which again can consist of multiple child modules and so on.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The root module</p>
</li>
<li>
<p>The application module(s), bundle all modules of an application and define the composition of deployable artifact buulding a runnable application, e.g. a war module</p>
</li>
<li>
<p>The component module(s), define reusable components which are not deployable in isolation</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void apply(ProjectContext context) {
    Modules modules = context.getModules();
    Module module = modules.getModule("path/of/module");
    boolean isMultiModule = modules.isMultiModuleProject();
    Module root = modules.getRootModule(); // type="pom" or type="ear"
    modules.getApplicationModules(); // type="war", containing "main" method
    modules.getComponentModules(); // type="jar" without main method

    List&lt;Module&gt; parentModules = module.getParentModules();
    List&lt;Module&gt; subModules = module.getSubModules();
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_finding_the_module_containing_a_resource">Finding the <code>Module</code> containing a resource</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Only "Maven" <code>main</code> and <code>test</code> are used as source sets and any settings in the pom.xml or otherwise are ignored.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ProjectResource pr = ...
Optional&lt;Module&gt; module = context.getModules.findModuleContaining(pr.getAbsolutePath());</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_buildfile_and_dependencies">4.7. BuildFile and Dependencies</h3>
<div class="paragraph">
<p>The buildfiles of the scanned project are represented by <code>BuildFile</code>.
The <code>BuildFile</code> API offers methods to read and modify the buildfile.
<code>BuildFile</code>s can be retrieved through the <code>ProjectContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    // Retrieve the root build file
    BuildFile rootBuildFile = projectContext.getBuildFile();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_adding_a_dependency">4.7.1. Adding a Dependency</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void apply(ProjectContext context) {
    // ...get buildFile for module
    BuildFile buildFile = context...
    Dependency dependency = Dependency.builder()
                                .groupId("...")
                                .artifactId("...")
                                .version("...")
                                .scope("test")
                                .build();
    buildFile.addDependency(dependency);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removing_a_dependency">4.7.2. Removing a Dependency</h4>

</div>
<div class="sect3">
<h4 id="_adding_dependency_exclusion">4.7.3. Adding Dependency Exclusion</h4>

</div>
</div>
<div class="sect2">
<h3 id="_migrating_java_code">4.8. Migrating Java Code</h3>
<div class="sect3">
<h4 id="_access_all_javasources">4.8.1. Access all JavaSources</h4>

</div>
<div class="sect3">
<h4 id="_adding_annotations">4.8.2. Adding annotations</h4>

</div>
<div class="sect3">
<h4 id="_removing_annotations">4.8.3. Removing annotations</h4>

</div>
<div class="sect3">
<h4 id="_modifying_annotations">4.8.4. Modifying annotations</h4>

</div>
<div class="sect3">
<h4 id="_migrating_methods">4.8.5. Migrating Methods</h4>

</div>
<div class="sect3">
<h4 id="_add_a_new_javasource">4.8.6. Add a new JavaSource</h4>
<div class="paragraph">
<p>A new <code>JavaSource</code> must be added to a <code>JavaSourceSet</code> of a given <code>ApplicationModule</code>.
The default <code>JavaSourceSet</code>s are 'main' (<code>src/main/java</code>) and 'test' (<code>src/test/java</code>).</p>
</div>
<div class="paragraph">
<p>Example: Adding a new Java class to the 'main' source set of an <code>ApplicationModule</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void apply(ProjectContext context) {

    ApplicationModule targetModule = ... // retrieve target module

    String javaCode =
        "package com.example.foo;\n" +
        "public class Bar {}";

    Path projectRootDirectory = context.getProjectRootDirectory();

    targetModule.getMainJavaSourceSet().addJavaSource(projectRootDirectory, sourceFolder, src, packageName);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openrewrite_recipe_and_visitor">4.9. OpenRewrite Recipe and Visitor</h3>

</div>
<div class="sect2">
<h3 id="_use_freemarker_templates">4.10. Use Freemarker templates</h3>
<div class="paragraph">
<p>Add this snippet to your Action to use freemarker</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyAction extends AbstractAction {

    @Autowired
    @JsonIgnore
    @Setter
    private Configuration configuration;

    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and place your template under <code>src/main/resources/templates</code></p>
</div>
<div class="paragraph">
<p>Example: using Freemarker template in Action</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Map&lt;String, String&gt; params = new HashMap&lt;&gt;();
params.put("groupId", "com.example.change");
params.put("artifactId", projectName);
params.put("version", "0.1.0-SNAPSHOT");

StringWriter writer = new StringWriter();
try {
    Template template = configuration.getTemplate("minimal-pom-xml.ftl");
    template.process(params, writer);
} catch (TemplateException | IOException e) {
    throw new RuntimeException(e);
}
String src = writer.toString();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_migrate_multi_module_projects">4.11. Migrate Multi Module Projects</h3>
<div class="sect3">
<h4 id="_access_a_modules_javasources">4.11.1. Access a Module&#8217;s JavaSources</h4>

</div>
</div>
<div class="sect2">
<h3 id="Specialized_Resources">4.12. Specialized Resources</h3>
<div class="sect3">
<h4 id="_create_a_finder_to_access_other_resources">4.12.1. Create a Finder to access other resources</h4>
<div class="paragraph">
<p>The <code>ProjectContext</code> only offers direct access to Java and BuildFile resources.
To access other resources the concept of <code>Finder</code>s exists.
A <code>Finder</code> implements the <code>ResourceFinder</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ProjectResourceFinder&lt;T&gt; {
    T apply(ProjectResourceSet projectResourceSet);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These <code>Finder</code>s can than be provided to the <code>search(&#8230;&#8203;)</code> method of <code>ProjectContext</code>.
The <code>ProjectContext</code> will provide the <code>ProjectResourceSet</code> to the <code>Finder</code> and the <code>Finder</code> can then filter/search</p>
</div>
</div>
<div class="sect3">
<h4 id="_manipulate_spring_boot_properties">4.12.2. Manipulate Spring Boot properties</h4>

</div>
<div class="sect3">
<h4 id="_create_a_specialized_resource">4.12.3. Create a specialized Resource</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing">5. Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Different classes exist to help writing tests for <code>Recipe</code>s, <code>Condition</code>s and <code>Action</code>s.</p>
</div>
<div class="sect2">
<h3 id="_windows_linux">5.1. Windows &amp; Linux</h3>
<div class="paragraph">
<p>Linebreaks, encoding and path separator do (most probably will) differ depending on the OS the tests and the application
is executed on.</p>
</div>
<div class="paragraph">
<p>To make the tests and application run on Windows, Linux and OSX you must take precautions in some cases.</p>
</div>
<div class="sect3">
<h4 id="_ignoring_line_separator_in_assertions">5.1.1. Ignoring Line separator in assertions</h4>

</div>
</div>
<div class="sect2">
<h3 id="_testprojectcontext">5.2. TestProjectContext</h3>
<div class="paragraph">
<p>When testing <code>Action</code>s and <code>Condition</code>s you&#8217;ll need a initialized ProjectContext as test fixture.
To avoid reading projects for testing from the filesystem the <code>TestProjectContext</code> can be used.</p>
</div>
<div class="paragraph">
<p>The <code>TestProjectContext</code> offers ways to create all kinds of ProjectContext instances initialized from resorces given as
strings as if they were read from filesystem. Have a look at the API documentation for details.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates different pom.xml. A blank default, with given dependencies defined, from a given String or as Mockito mock</p>
</li>
<li>
<p>Provides a method to register additional ResourceWrapper for specialized resources</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String sourceCode = "package com.acme.app;\npublic class MyClass {}";

ProjectContext projectContext = TestProjectContext.buildProjectContext() <b class="conum">(1)</b>
        .withBuildFileHavingDependencies("org.junit.jupiter:junit-jupiter-api:5.7.0") <b class="conum">(2)</b>
        .withJavaSources(sourceCode) <b class="conum">(3)</b>
        .build(); <b class="conum">(4)</b>

// Use ProjectContext to test Action or Condition</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Call TestProjectContext static builder method which will inject a mock for ApplicationEventPublisher</p>
</li>
<li>
<p>Add required dependencies to the classpath (assume they&#8217;re needed). This will add a pom.xml declaring the provided dependencies.</p>
</li>
<li>
<p>Add a new Java file with given source to <code>src/main/java/com/acme/app/MyClass.java</code></p>
</li>
<li>
<p>build and return the initialized ProjectContext.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_projectcontextfilesystemtestsupport">5.3. ProjectContextFileSystemTestSupport</h3>
<div class="paragraph">
<p>If you want to create a ProjectContext from filesystem, <code>ProjectContextFileSystemTestSupport</code> is your friend.<br>
It assumes a directory <code>testcode</code> in the same module as the test resides in.
The initial project is read from a <code>given</code> directory inside <code>testcode</code>, let&#8217;s say <code>testcode/given/my-project</code>.
The resources are then copied to <code>target/test-projects/my-project</code> and the ProjectContext is created from this directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
void someTest() {
    ProjectContext projectContext = ProjectContextFileSystemTestSupport
                                            .createProjectContextFromDir("boot-23-app");
    // modify ProjectContext
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copies all resources from <code>./testcode/given/boot-23-app</code> to <code>./target/test-projects/boot-23-app</code> and creates a ProjectContext from it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_recipeintegrationtestsupport">5.4. RecipeIntegrationTestSupport</h3>
<div class="paragraph">
<p>If you want to integration test a recipe against a project read from filesystem, <code>RecipeIntegrationTestSupport</code> can help you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String applicationDir = "example-app"; <b class="conum">(1)</b>

RecipeIntegrationTestSupport.initializeProject(applicationDir)
        .andApplyRecipe("boot-2.4-2.5-datasource-initializer"); <b class="conum">(2)</b>

Path javaClass = RecipeIntegrationTestSupport.getResultDir(applicationDir).resolve("src/main/java/com/example/SomeJavaClass.java"); <b class="conum">(3)</b>

assertThat(javaClass).hasContent("..."); <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provide a project, here under <code>./testcode/example-app/given</code>.
This project will be copied to a clean dir <code>target/test-projects/example-app</code></p>
</li>
<li>
<p>Scan the copied project and apply the given recipe against it</p>
</li>
<li>
<p>Retrieve the path to a resource after migration</p>
</li>
<li>
<p>Verify the resource has expected content</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_integrationtestbaseclass">5.5. IntegrationTestBaseClass</h3>
<div class="paragraph">
<p>For end-to-end tests using the shell commands <code>IntegrationTestBaseClass</code> will be helpful.<br>
These are the most complete tests but also the slowest.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently these tests reside in <code>spring-shell</code> module.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyFullBlownIntegrationTest extends IntegrationTestBaseClass {
    @Override
    protected String getTestSubDir() { <b class="conum">(1)</b>
        return "some-dir/project-dir"; <b class="conum">(2)</b>
    }

    @Test
    @Tag("integration")
    void migrateSomethingToSpringBoot() {
        initializeTestProject(); <b class="conum">(3)</b>
        scanProject(); <b class="conum">(4)</b>
        applyRecipe("initialize-spring-boot-migration"); <b class="conum">(5)</b>
        applyRecipe("migrate-x-to-boot"); <b class="conum">(6)</b>
        // simulate manual step
        replaceFile( <b class="conum">(7)</b>
                getTestDir().resolve("src/test/java/com/example/jee/app/PersonServiceTest.java"),
                getTestDir().resolve("manual-step/BootifiedPersonServiceTest.java")
        );
        String localBusinessInterface = loadJavaFile("com.example.jee.app.ejb.local", "ABusinessInterface"); <b class="conum">(8)</b>
        // verify @Local was removed
        assertThat(localBusinessInterface).doesNotContain("@Local"); <b class="conum">(9)</b>
        executeMavenGoals(getTestDir(), "clean", "package", "spring-boot:build-image"); <b class="conum">(10)</b>
        int port = startDockerContainer("jee-app:8.0.5-SNAPSHOT", 8080); <b class="conum">(11)</b>
        TestRestTemplate testRestTemplate = new TestRestTemplate(); <b class="conum">(12)</b>
        // Test Servlet
        String response = testRestTemplate.getForObject("http://localhost:" + port + "/HelloWorld", String.class); <b class="conum">(13)</b>
        assertThat(response).isEqualTo("Hello World!"); <b class="conum">(14)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>getTestSubDir()</code> method must be implemented.</p>
</li>
<li>
<p>It must return the path to the test project in <code>src/test/resources</code></p>
</li>
<li>
<p>Copies test project from <code>src/test/resources/some-dir/project-dir</code> to <code>target/sbm-integration-test/some-dir/project-dir</code></p>
</li>
<li>
<p>Scans the copied test project, same as calling <code>scan</code> in CLI</p>
</li>
<li>
<p>Apply the recipe <code>initialize-spring-boot-migration</code>, same as calling <code>apply initialize-spring-boot-migration</code> in CLI.
Changes will be reflected in the filesystem after this call.</p>
</li>
<li>
<p>Apply another recipe <code>migrate-x-to-boot</code></p>
</li>
<li>
<p>Replace a file, here because the Test needs to be migrated manually</p>
</li>
<li>
<p>Load the content a Java file as String</p>
</li>
<li>
<p>Assertions about the context of the Java file</p>
</li>
<li>
<p>Call <code>mvn clean package spring-boot:build-image</code> in the test project</p>
</li>
<li>
<p>Start the docker image from the last step containing the migrated Spring application</p>
</li>
<li>
<p>Create a RestTemplate</p>
</li>
<li>
<p>Use the RestTemplate to retrive some data from the migrated Spring application running in Docker</p>
</li>
<li>
<p>Verify the response</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing">6. Contributing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You want to contribute to the Spring Boot Migrator project?</p>
</div>
<div class="paragraph">
<p>Great! All contributions are welcome.</p>
</div>
<div class="paragraph">
<p>If you have not previously done so, please sign the <a href="https://cla.pivotal.io/sign/spring">Contributor License Agreement</a>. You will be reminded automatically when you submit the pull request.</p>
</div>
<div class="paragraph">
<p>Please also see <a href="../../CONTRIBUTING.adoc">CONTRIBUTING.adoc</a> for further information.</p>
</div>
<div class="paragraph">
<p>All files need to have a license header. Please use this copyright text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Copyright 2022 the original author or authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

     https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure license headers under <code>IntelliJ IDEA/Copyright/Copyright Profile</code>.
See <a href="https://www.jetbrains.com/help/idea/copyright.html#configure-copyright-profiles" class="bare">https://www.jetbrains.com/help/idea/copyright.html#configure-copyright-profiles</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-11-11 10:11:51 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>